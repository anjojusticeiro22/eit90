<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Teste Arc Testnet</title>
</head>
<body>
  <h2>Teste de TransaÃ§Ã£o na Arc Testnet</h2>
  <button id="connectBtn">Conectar Carteira</button>
  <button id="txBtn" disabled>Enviar TransaÃ§Ã£o</button>
  <div id="status" style="margin-top:10px; font-family:Arial; line-height:1.4;"></div>

  <!-- ethers.js v6 -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.10.0/dist/ethers.umd.min.js"></script>
  <script>
    let provider, signer;

    const connectBtn = document.getElementById('connectBtn');
    const txBtn = document.getElementById('txBtn');
    const status = document.getElementById('status');

    connectBtn.onclick = async () => {
      try {
        if (!window.ethereum) {
          alert("Instale a carteira Rabby ou MetaMask.");
          return;
        }

        provider = new ethers.BrowserProvider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = await provider.getSigner();

        const network = await provider.getNetwork();
        const address = await signer.getAddress();

        status.innerHTML = `
          âœ… Carteira conectada: <b>${address}</b><br>
          ğŸŒ Rede: ${network.name} (ChainId: ${network.chainId})
        `;

        if (Number(network.chainId) !== 5042002) {
          alert("âš ï¸ Mude para a Arc Testnet na sua carteira.");
          txBtn.disabled = true;
        } else {
          txBtn.disabled = false;
        }

      } catch (err) {
        console.error(err);
        status.textContent = "âŒ Erro ao conectar: " + (err.message || err);
      }
    };

    txBtn.onclick = async () => {
      try {
        if (!signer) {
          alert("Conecte a carteira primeiro!");
          return;
        }

        status.textContent = "ğŸ“ Preparando transaÃ§Ã£o...";
        const tx = await signer.sendTransaction({
          to: await signer.getAddress(),
          value: 0n // apenas para assinar, sem enviar fundos
        });

        const explorer = `https://testnet.arcscan.app/tx/${tx.hash}`;
        status.innerHTML = `
          ğŸ’³ TransaÃ§Ã£o enviada: <a href="${explorer}" target="_blank">${tx.hash}</a>
        `;

        const receipt = await tx.wait();
        status.innerHTML += `<br>âœ… Confirmada no bloco ${receipt.blockNumber}`;

      } catch (err) {
        console.error(err);
        status.textContent = "âŒ Erro ao enviar transaÃ§Ã£o: " + (err.message || err);
      }
    };
  </script>
</body>
</html>
